<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generar Excel - Autos Colin</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background-color: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .logo i {
            font-size: 28px;
            color: #3498db;
        }
        
        h1 {
            font-size: 24px;
            font-weight: 600;
        }
        
        .subtitle {
            color: #bdc3c7;
            font-size: 14px;
        }
        
        .content {
            padding: 30px;
        }
        
        .data-section {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            color: #3498db;
        }
        
        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .data-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background-color: white;
            border-radius: 5px;
            border: 1px solid #eaeaea;
        }
        
        .data-label {
            font-weight: 500;
            color: #555;
        }
        
        .data-value {
            font-weight: 600;
            font-family: 'Courier New', monospace;
        }
        
        .positive {
            color: #27ae60;
        }
        
        .negative {
            color: #e74c3c;
        }
        
        .export-options {
            background-color: #e8f4fc;
            padding: 25px;
            border-radius: 8px;
            margin-top: 30px;
            text-align: center;
        }
        
        .export-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .export-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .excel-btn {
            background-color: #217346;
            color: white;
        }
        
        .excel-btn:hover {
            background-color: #1a5c38;
        }
        
        .pdf-btn {
            background-color: #e74c3c;
            color: white;
        }
        
        .pdf-btn:hover {
            background-color: #c0392b;
        }
        
        .back-btn {
            background-color: #3498db;
            color: white;
        }
        
        .back-btn:hover {
            background-color: #2980b9;
        }
        
        .excel-preview {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-top: 30px;
            overflow-x: auto;
        }
        
        .excel-table {
            width: 100%;
            border-collapse: collapse;
            font-family: Arial, sans-serif;
            font-size: 12px;
        }
        
        .excel-table th {
            background-color: #e9ecef;
            border: 1px solid #dee2e6;
            padding: 8px;
            text-align: center;
            font-weight: 600;
        }
        
        .excel-table td {
            border: 1px solid #dee2e6;
            padding: 6px 8px;
            text-align: right;
        }
        
        .excel-table .header-cell {
            background-color: #d1ecf1;
            font-weight: bold;
            text-align: center;
        }
        
        .excel-table .total-cell {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        
        .instructions {
            margin-top: 25px;
            padding: 15px;
            background-color: #fff8e1;
            border-radius: 5px;
            border-left: 4px solid #ffc107;
        }
        
        .instructions h3 {
            color: #856404;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
            font-size: 14px;
            border-top: 1px solid #eee;
            margin-top: 20px;
        }
        
        .loading {
            display: none;
            margin-top: 20px;
            text-align: center;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-file-excel"></i>
                <h1>GENERAR REPORTE EXCEL</h1>
            </div>
            <p class="subtitle">Exportar datos financieros de Autos Colin al formato Excel</p>
        </header>
        
        <div class="content">
            <div class="data-section">
                <h2 class="section-title">
                    <i class="fas fa-database"></i> Datos a Exportar
                </h2>
                <p>Se exportarán los siguientes datos al archivo Excel:</p>
                
                <div class="data-grid" id="data-summary">
                    <!-- Los datos se cargarán dinámicamente -->
                </div>
            </div>
            
            <div class="export-options">
                <h2 class="section-title">
                    <i class="fas fa-download"></i> Opciones de Exportación
                </h2>
                <p>Seleccione el formato en el que desea descargar el reporte:</p>
                
                <div class="export-buttons">
                    <button class="export-btn excel-btn" id="generate-excel">
                        <i class="fas fa-file-excel"></i> Generar Excel
                    </button>
                    <button class="export-btn pdf-btn" id="generate-pdf">
                        <i class="fas fa-file-pdf"></i> Generar PDF
                    </button>
                    <button class="export-btn back-btn" id="go-back">
                        <i class="fas fa-arrow-left"></i> Volver al Sistema
                    </button>
                </div>
                
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>Generando archivo, por favor espere...</p>
                </div>
            </div>
            
            <div class="excel-preview">
                <h2 class="section-title">
                    <i class="fas fa-eye"></i> Vista Previa del Excel
                </h2>
                <p>Así se verá el archivo Excel generado:</p>
                
                <table class="excel-table" id="excel-preview">
                    <!-- La vista previa se generará dinámicamente -->
                </table>
            </div>
            
            <div class="instructions">
                <h3><i class="fas fa-info-circle"></i> Instrucciones</h3>
                <ul>
                    <li>El archivo Excel mantendrá el mismo formato que el archivo original "JULIO CONTA 2025.xlsx".</li>
                    <li>Los datos de vehículos comprados y vendidos se obtendrán de la base de datos.</li>
                    <li>Los gastos ingresados manualmente en el sistema se incluirán en el reporte.</li>
                    <li>Puede seleccionar el período (mes o anual) para el reporte.</li>
                    <li>El archivo se descargará automáticamente cuando esté listo.</li>
                </ul>
            </div>
        </div>
        
        <footer>
            <p>Sistema de Control Financiero para Autos Colin - Generador de Reportes</p>
            <p>© 2025 - Todos los derechos reservados</p>
        </footer>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script>
        // Datos de ejemplo (en una implementación real, estos vendrían del sistema principal)
        const sampleData = {
            period: "Julio 2025",
            initialAmount: 5000000,
            totalExpenses: 1250000,
            availableBalance: 3750000,
            inventoryNet: 214235130,
            credits: 11450000,
            cash: 400000,
            workingTotal: 226085130,
            banks: {
                bcrColones: 119250000,
                bcrDollars: 0,
                bacColones: 2646600,
                bacDollars: 6120000,
                total: 127476600
            },
            vehiclesPurchased: [
                { id: 1, vehicle: "Toyota Corolla 2020", amount: 12500000 },
                { id: 2, vehicle: "Honda Civic 2019", amount: 11000000 },
                { id: 3, vehicle: "Mazda 3 2021", amount: 13500000 },
                { id: 4, vehicle: "Hyundai Tucson 2022", amount: 18500000 }
            ],
            vehiclesSold: [
                { id: 1, vehicle: "Toyota Corolla 2020", profit: 1500000 },
                { id: 2, vehicle: "Honda Civic 2019", profit: 1200000 },
                { id: 3, vehicle: "Mazda 3 2021", profit: 1800000 }
            ],
            expenses: [
                { id: 1, description: "ALQUILER", amount: 150000 },
                { id: 2, description: "ALQUILER", amount: 150000 },
                { id: 3, description: "TEL 1", amount: 45000 },
                { id: 4, description: "CEL 2", amount: 35000 },
                { id: 5, description: "CEL 3", amount: 35000 },
                { id: 6, description: "CEL 4", amount: 35000 },
                { id: 7, description: "CORRIENTE", amount: 85000 },
                { id: 8, description: "AGUA Y BASURA", amount: 25000 },
                { id: 9, description: "CABLE", amount: 30000 },
                { id: 10, description: "CRAUTOS", amount: 0 },
                { id: 11, description: "INTERNET", amount: 45000 },
                { id: 12, description: "JARDIN", amount: 20000 },
                { id: 13, description: "SEGURO CARROS", amount: 120000 },
                { id: 14, description: "LIQUIDOS", amount: 0 },
                { id: 15, description: "SELCA", amount: 0 },
                { id: 16, description: "HERMANOS", amount: 0 },
                { id: 17, description: "PAPI", amount: 0 },
                { id: 18, description: "MANFRED", amount: 0 },
                { id: 19, description: "NAZA", amount: 0 },
                { id: 20, description: "TAVITO", amount: 0 },
                { id: 21, description: "RAFITA", amount: 0 },
                { id: 22, description: "PAGO DE CARRO", amount: 250000 }
            ],
            totals: {
                purchased: 55500000,
                sold: 4500000,
                profit: 4500000,
                expenses: 1250000,
                netProfit: 3250000
            }
        };

        // Función para formatear números con separadores de miles
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        }

        // Función para cargar el resumen de datos
        function loadDataSummary() {
            const dataSummary = document.getElementById('data-summary');
            
            const summaryItems = [
                { label: "Período del Reporte", value: sampleData.period },
                { label: "Plata Inicial", value: `₡ ${formatNumber(sampleData.initialAmount)}` },
                { label: "Total Gastos", value: `₡ ${formatNumber(sampleData.totalExpenses)}` },
                { label: "Saldo Disponible", value: `₡ ${formatNumber(sampleData.availableBalance)}` },
                { label: "Inventario Neto", value: `₡ ${formatNumber(sampleData.inventoryNet)}` },
                { label: "Total Bancos", value: `₡ ${formatNumber(sampleData.banks.total)}` },
                { label: "Vehículos Comprados", value: formatNumber(sampleData.vehiclesPurchased.length) },
                { label: "Vehículos Vendidos", value: formatNumber(sampleData.vehiclesSold.length) },
                { label: "Ganancia Neta", value: `₡ ${formatNumber(sampleData.totals.netProfit)}`, class: "positive" }
            ];
            
            dataSummary.innerHTML = '';
            
            summaryItems.forEach(item => {
                const div = document.createElement('div');
                div.className = 'data-item';
                div.innerHTML = `
                    <span class="data-label">${item.label}</span>
                    <span class="data-value ${item.class || ''}">${item.value}</span>
                `;
                dataSummary.appendChild(div);
            });
        }

        // Función para generar la vista previa del Excel
        function generateExcelPreview() {
            const previewTable = document.getElementById('excel-preview');
            
            // Limpiar tabla
            previewTable.innerHTML = '';
            
            // Crear estructura similar al Excel original
            const headers = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R'];
            
            // Fila de encabezados de columnas
            let headerRow = document.createElement('tr');
            headers.forEach(header => {
                const th = document.createElement('th');
                th.textContent = header;
                headerRow.appendChild(th);
            });
            previewTable.appendChild(headerRow);
            
            // Fila 1: Vacía
            previewTable.appendChild(createExcelRow(['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']));
            
            // Fila 2: PLATA INICIAL y VEHICULOS COMPRADOS
            previewTable.appendChild(createExcelRow([
                '', 'PLATA INICIAL', '', '', '', '', '', '', '', '', 'VEHICULOS COMPRADOS', '', '', '', '', '', '', ''
            ], 'header-cell'));
            
            // Fila 3: RESUMEN DE GASTOS y encabezados de montos
            previewTable.appendChild(createExcelRow([
                '', 'RESUMEN DE GASTOS', '', '', '', '', '', '', '', '', '', '', 'MONTO', '', '', 'MONTO', '', ''
            ], 'header-cell'));
            
            // Filas 4-13: Gastos (1-10)
            for (let i = 0; i < 10; i++) {
                const expense = sampleData.expenses[i] || { description: '', amount: 0 };
                previewTable.appendChild(createExcelRow([
                    '', '', i === 0 ? sampleData.initialAmount : '', '', '', '', '', '', '', '',
                    `${i+1})`, '', expense.description, '', expense.amount, '', ''
                ]));
            }
            
            // Fila 14: Gastos (11-20) y TOTAL
            const expense11 = sampleData.expenses[10] || { description: '', amount: 0 };
            previewTable.appendChild(createExcelRow([
                '', '', '', '', '', '', '', '', '', '',
                '11)', '', expense11.description, '', expense11.amount, 'TOTAL', '', sampleData.totals.purchased
            ]));
            
            // Fila 15-24: Gastos (12-20)
            for (let i = 11; i < 20; i++) {
                const expense = sampleData.expenses[i] || { description: '', amount: 0 };
                previewTable.appendChild(createExcelRow([
                    '', '', '', '', '', '', '', '', '', '',
                    `${i+1})`, '', expense.description, '', expense.amount, '', ''
                ]));
            }
            
            // Fila 25: Vacía
            previewTable.appendChild(createExcelRow(['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']));
            
            // Fila 26: INICIO y VEHICULOS VENDIDOS
            previewTable.appendChild(createExcelRow([
                '', '', '', '', '', 'INICIO', sampleData.initialAmount, '', '', '', 'VEHICULOS VENDIDOS', '', '', '', '', '', '', ''
            ], 'header-cell'));
            
            // Fila 27: GASTOS y GANANCIA
            previewTable.appendChild(createExcelRow([
                '', '', '', '', '', 'GASTOS', sampleData.totalExpenses, '', '', '', '', '', 'GANACIA', '', '', 'GANANCIA', '', ''
            ], 'header-cell'));
            
            // Fila 28: TOTAL
            previewTable.appendChild(createExcelRow([
                '', '', '', '', '', 'TOTAL', sampleData.availableBalance, '', '', '', '', '', '', '', '', '', '', ''
            ], 'header-cell'));
            
            // Filas 29-38: Vehículos vendidos (1-10)
            for (let i = 0; i < 10; i++) {
                const vehicle = sampleData.vehiclesSold[i] || { vehicle: '', profit: 0 };
                previewTable.appendChild(createExcelRow([
                    '', '', '', '', '', '', '', '', '', '',
                    `${i+1})`, '', vehicle.vehicle, '', vehicle.profit, '', ''
                ]));
            }
            
            // Fila 39: Vehículo vendido 11 y TOTAL
            const vehicle11 = sampleData.vehiclesSold[10] || { vehicle: '', profit: 0 };
            previewTable.appendChild(createExcelRow([
                '', '', '', '', '', '', '', '', '', '',
                '11)', '', vehicle11.vehicle, '', vehicle11.profit, 'TOTAL', '', sampleData.totals.sold
            ]));
            
            // Fila 40-49: Vehículos vendidos (12-20)
            for (let i = 11; i < 20; i++) {
                const vehicle = sampleData.vehiclesSold[i] || { vehicle: '', profit: 0 };
                previewTable.appendChild(createExcelRow([
                    '', '', '', '', '', '', '', '', '', '',
                    `${i+1})`, '', vehicle.vehicle, '', vehicle.profit, '', ''
                ]));
            }
            
            // Fila 50: Vacía
            previewTable.appendChild(createExcelRow(['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '', '']));
            
            // Fila 51: TOTAL EN GASTOS y GASTOS
            previewTable.appendChild(createExcelRow([
                '', 'TOTAL EN GASTOS', sampleData.totalExpenses, '', '', '', '', '', '', '', 'GASTOS', '', '', '', '', '', '', ''
            ], 'header-cell'));
            
            // Filas 52-75: Detalle de gastos
            for (let i = 0; i < 24; i++) {
                const expense = sampleData.expenses[i] || { description: i < 22 ? '' : '-', amount: 0 };
                previewTable.appendChild(createExcelRow([
                    '', '', '', '', '', '', '', '', '', '',
                    `${i+1})`, '', expense.description, '', expense.amount, '', ''
                ]));
            }
            
            // Fila 76: TOTAL GASTOS
            previewTable.appendChild(createExcelRow([
                '', '', '', '', '', '', '', '', '', '',
                '', '', 'TOTAL', '', sampleData.totalExpenses, '', '', ''
            ], 'total-cell'));
        }

        // Función auxiliar para crear una fila de la tabla Excel
        function createExcelRow(cells, cellClass = '') {
            const row = document.createElement('tr');
            
            cells.forEach((cell, index) => {
                const td = document.createElement('td');
                td.textContent = cell;
                if (cellClass) {
                    td.className = cellClass;
                }
                // Si es un número, alinear a la derecha
                if (typeof cell === 'number') {
                    td.style.textAlign = 'right';
                    td.textContent = formatNumber(cell);
                }
                row.appendChild(td);
            });
            
            return row;
        }

        // Función para generar el archivo Excel
        function generateExcelFile() {
            // Mostrar loading
            document.getElementById('loading').style.display = 'block';
            
            // Crear libro de trabajo
            const wb = XLSX.utils.book_new();
            wb.Props = {
                Title: `AUTOS COLIN - ${sampleData.period}`,
                Subject: "Reporte Financiero",
                Author: "Sistema Autos Colin",
                CreatedDate: new Date()
            };
            
            // Crear hoja de cálculo
            const ws_name = "AUTOS COLIN";
            
            // Crear datos para la hoja (simulando el formato del Excel original)
            const ws_data = [
                // Filas 1-18 (A-R)
                ["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""],
                ["", "PLATA INICIAL", "", "", "", "", "", "", "", "", "VEHICULOS COMPRADOS", "", "", "", "", "", "", ""],
                ["", "RESUMEN DE GASTOS", "", "", "", "", "", "", "", "", "", "", "MONTO", "", "", "MONTO", "", ""],
            ];
            
            // Agregar filas de gastos 1-10
            for (let i = 0; i < 10; i++) {
                const expense = sampleData.expenses[i] || { description: '', amount: 0 };
                ws_data.push([
                    "", "", i === 0 ? sampleData.initialAmount : "", "", "", "", "", "", "", "",
                    `${i+1})`, "", expense.description, "", expense.amount, "", "", ""
                ]);
            }
            
            // Fila 11-20
            const expense11 = sampleData.expenses[10] || { description: '', amount: 0 };
            ws_data.push([
                "", "", "", "", "", "", "", "", "", "",
                "11)", "", expense11.description, "", expense11.amount, "TOTAL", "", sampleData.totals.purchased
            ]);
            
            for (let i = 11; i < 20; i++) {
                const expense = sampleData.expenses[i] || { description: '', amount: 0 };
                ws_data.push([
                    "", "", "", "", "", "", "", "", "", "",
                    `${i+1})`, "", expense.description, "", expense.amount, "", "", ""
                ]);
            }
            
            // Más filas...
            ws_data.push(["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]);
            ws_data.push(["", "", "", "", "", "INICIO", sampleData.initialAmount, "", "", "", "VEHICULOS VENDIDOS", "", "", "", "", "", "", ""]);
            ws_data.push(["", "", "", "", "", "GASTOS", sampleData.totalExpenses, "", "", "", "", "", "GANACIA", "", "", "GANANCIA", "", ""]);
            ws_data.push(["", "", "", "", "", "TOTAL", sampleData.availableBalance, "", "", "", "", "", "", "", "", "", "", ""]);
            
            // Vehículos vendidos
            for (let i = 0; i < 10; i++) {
                const vehicle = sampleData.vehiclesSold[i] || { vehicle: '', profit: 0 };
                ws_data.push([
                    "", "", "", "", "", "", "", "", "", "",
                    `${i+1})`, "", vehicle.vehicle, "", vehicle.profit, "", "", ""
                ]);
            }
            
            const vehicle11 = sampleData.vehiclesSold[10] || { vehicle: '', profit: 0 };
            ws_data.push([
                "", "", "", "", "", "", "", "", "", "",
                "11)", "", vehicle11.vehicle, "", vehicle11.profit, "TOTAL", "", sampleData.totals.sold
            ]);
            
            for (let i = 11; i < 20; i++) {
                const vehicle = sampleData.vehiclesSold[i] || { vehicle: '', profit: 0 };
                ws_data.push([
                    "", "", "", "", "", "", "", "", "", "",
                    `${i+1})`, "", vehicle.vehicle, "", vehicle.profit, "", "", ""
                ]);
            }
            
            ws_data.push(["", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]);
            ws_data.push(["", "TOTAL EN GASTOS", sampleData.totalExpenses, "", "", "", "", "", "", "", "GASTOS", "", "", "", "", "", "", ""]);
            
            // Detalle de gastos
            for (let i = 0; i < 24; i++) {
                const expense = sampleData.expenses[i] || { description: i < 22 ? '' : '-', amount: 0 };
                ws_data.push([
                    "", "", "", "", "", "", "", "", "", "",
                    `${i+1})`, "", expense.description, "", expense.amount, "", "", ""
                ]);
            }
            
            ws_data.push(["", "", "", "", "", "", "", "", "", "",
                "", "", "TOTAL", "", sampleData.totalExpenses, "", "", ""]);
            
            // Sección de PLATA TRABAJANDO y PLATA BANCOS
            ws_data.push(["", "PLATA TRABAJANDO", "", "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]);
            ws_data.push(["", "", "", "", "AUTOS COLIN", "", "", "", "", "", "", "", "", "", "", "", "", ""]);
            ws_data.push(["", "", "", "", "INVENTARIO NETO", sampleData.inventoryNet, "", "", "", "", "", "", "", "", "", "", "", ""]);
            ws_data.push(["", "PLATA BANCOS", "", "", "CREDITOS", sampleData.credits, "", "", "", "", "", "", "", "", "", "", "", ""]);
            ws_data.push(["", "BCR COLONES", sampleData.banks.bcrColones, "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]);
            ws_data.push(["", "BCR DOLARES", sampleData.banks.bcrDollars, "", "EFECTIVO", sampleData.cash, "", "", "", "", "", "", "", "", "", "", "", ""]);
            ws_data.push(["", "BAC COLONES", sampleData.banks.bacColones, "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]);
            ws_data.push(["", "BAC DOLARES", sampleData.banks.bacDollars, "", "TOTAL", sampleData.workingTotal, "", "", "", "", "", "", "", "", "", "", "", ""]);
            ws_data.push(["", "TOTAL PLATA  BANCOS", sampleData.banks.total, "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]);
            ws_data.push(["", "TOTAL PLATA TRABAJANDO", sampleData.workingTotal, "", "", "", "", "", "", "", "", "", "", "", "", "", "", ""]);
            ws_data.push(["", "", "", "", "", "", "", "", "", "", "VEHICULO COMPRADOS", "", "", "", sampleData.totals.purchased, "", "", ""]);
            ws_data.push(["", "", "", "", "", "", "", "", "", "", "VEHICULO VENDIDOS", "", "", "", sampleData.totals.sold, "", "", ""]);
            ws_data.push(["", "TOTAL", sampleData.initialAmount + sampleData.workingTotal, "", "", "", "", "", "", "", "TOTAL GANANCIA", "", "", "", sampleData.totals.profit, "", "", ""]);
            ws_data.push(["", "", "", "", "", "", "", "", "", "", "GASTOS", "", "", "", sampleData.totalExpenses, "", "", ""]);
            ws_data.push(["", "", "", "", "", "", "", "", "", "", "GANANCIA NETA", "", "", "", sampleData.totals.netProfit, "", "", ""]);
            
            // Crear hoja de cálculo
            const ws = XLSX.utils.aoa_to_sheet(ws_data);
            
            // Ajustar anchos de columna
            const colWidths = [
                { wch: 5 }, { wch: 15 }, { wch: 15 }, { wch: 5 }, { wch: 15 }, 
                { wch: 10 }, { wch: 12 }, { wch: 5 }, { wch: 5 }, { wch: 5 },
                { wch: 10 }, { wch: 5 }, { wch: 15 }, { wch: 5 }, { wch: 12 },
                { wch: 12 }, { wch: 5 }, { wch: 15 }
            ];
            ws['!cols'] = colWidths;
            
            // Agregar hoja al libro
            XLSX.utils.book_append_sheet(wb, ws, ws_name);
            
            // Simular un pequeño retardo para mostrar el loading
            setTimeout(() => {
                // Generar archivo
                const wbout = XLSX.write(wb, { bookType: 'xlsx', type: 'binary' });
                
                // Convertir a blob y descargar
                function s2ab(s) {
                    const buf = new ArrayBuffer(s.length);
                    const view = new Uint8Array(buf);
                    for (let i = 0; i < s.length; i++) view[i] = s.charCodeAt(i) & 0xFF;
                    return buf;
                }
                
                const blob = new Blob([s2ab(wbout)], { type: "application/octet-stream" });
                const fileName = `AUTOS_COLIN_${sampleData.period.replace(/\s+/g, '_')}.xlsx`;
                
                saveAs(blob, fileName);
                
                // Ocultar loading
                document.getElementById('loading').style.display = 'none';
                
                // Mostrar mensaje de éxito
                alert(`Archivo Excel "${fileName}" generado y descargado exitosamente.`);
            }, 1500);
        }

        // Función para generar PDF (simulación)
        function generatePDF() {
            document.getElementById('loading').style.display = 'block';
            
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
                alert("Función de generación de PDF en desarrollo. En una implementación real, se usaría una librería como jsPDF o se enviaría al servidor para generarlo.");
            }, 1500);
        }

        // Función para volver al sistema principal
        function goBack() {
            // En una implementación real, redirigiría a la página principal
            // Por ahora, mostramos un mensaje
            alert("Redirigiendo al sistema principal...");
            // window.location.href = "index.html"; // Descomentar en implementación real
        }

        // Inicialización al cargar la página
        document.addEventListener('DOMContentLoaded', function() {
            loadDataSummary();
            generateExcelPreview();
            
            // Configurar eventos
            document.getElementById('generate-excel').addEventListener('click', generateExcelFile);
            document.getElementById('generate-pdf').addEventListener('click', generatePDF);
            document.getElementById('go-back').addEventListener('click', goBack);
            
            // Simular obtención de datos del sistema principal
            console.log("En una implementación real, los datos se obtendrían:");
            console.log("1. Del sistema principal a través de localStorage o sessionStorage");
            console.log("2. De una API del servidor");
            console.log("3. De parámetros en la URL");
        });
    </script>
</body>
</html>